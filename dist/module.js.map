{"version":3,"sources":["../src/module.js"],"names":["_","MetricsPanelCtrl","kbn","TimeSeries","legend","$","barchzCtrl","$scope","$injector","$rootScope","panelDefaults","show","values","links","datasource","maxDataPoints","interval","targets","cacheTimeout","nullPointMode","legendTable","aliasColors","format","valueName","yaxis","label","tickDecimals","xaxis","decimals","defaults","panel","events","on","onRender","bind","onDataReceived","onDataError","onInitEditMode","addEditorTab","unitFormats","getUnitFormats","subItem","value","render","series","data","parseSeries","map","serie","i","alias","flotpairs","color","colors","dataList","seriesHandler","seriesData","datapoints","target","getFlotPairs","isNumber","scaledDecimals","delta","dec","Math","floor","log","LN10","magn","pow","norm","size","result","max","decimalInfo","getDecimalsForValue","formatFunc","valueFormats","scope","elem","attrs","ctrl","find","$tooltip","renderingCompleted","setElementHeight","height","row","isString","parseInt","replace","title","css","e","processOffsetHook","plot","gridMargin","left","right","drawHook","yaxisLabel","text","appendTo","style","marginTop","addbarchz","width","min","plotCanvas","plotCss","top","margin","position","$panelContainer","parents","backgroundColor","html","plotSeries","plotTicksX","plotTicksY","TotalAxisX","origData","push","ticks","options","stack","bars","align","horizontal","barWidth","lineWidth","hooks","draw","processOffset","tickFormatter","val","axis","formatValue","shadowSize","grid","minBorderMargin","markings","borderWidth","hoverable","selection","mode","event","pos","item","detach","body","formatted","place_tt","pageX","pageY","templateUrl"],"mappings":"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","file":"module.js","sourcesContent":["import _ from \"lodash\";\nimport {MetricsPanelCtrl} from \"app/plugins/sdk\";\nimport kbn from \"app/core/utils/kbn\";\nimport TimeSeries from \"app/core/time_series\";\nimport legend from './legend';\nimport './barchz-panel.css!';\nimport $ from \"jquery\";\nimport \"jquery.flot\";\nimport \"jquery.flot.stack\";\n\n\nexport class barchzCtrl extends MetricsPanelCtrl {\n\n    constructor($scope, $injector, $rootScope) {\n        super($scope, $injector);\n        this.$rootScope = $rootScope;\n\n        var panelDefaults = {\n            legend: {\n                show: true, // disable/enable legend\n                values: true\n            },\n            links: [],\n            datasource: null,\n            maxDataPoints: 3,\n            interval: null,\n            targets: [{}],\n            cacheTimeout: null,\n            nullPointMode: 'connected',\n            legendTable: false,\n            aliasColors: {},\n            format: 'short',\n            valueName: 'current',\n            yaxis: {\n                label: null,\n                show: true,\n                tickDecimals: 0\n            },\n            xaxis: {\n                show: true,\n                tickDecimals: 2\n            },\n            decimals: 2\n        };\n\n        _.defaults(this.panel, panelDefaults);\n        _.defaults(this.panel.legend, panelDefaults.legend);\n\n        this.events.on('render', this.onRender.bind(this));\n        this.events.on('data-received', this.onDataReceived.bind(this));\n        this.events.on('data-error', this.onDataError.bind(this));\n        this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    }\n\n    onInitEditMode() {\n        this.addEditorTab('Axes', 'public/plugins/grafana-barchz-panel/axes.html');\n        this.addEditorTab('Options', 'public/plugins/grafana-barchz-panel/editor.html');\n        this.unitFormats = kbn.getUnitFormats();\n    }\n\n    setUnitFormat(subItem) {\n        this.panel.format = subItem.value;\n        this.render();\n    }\n\n    onDataError() {\n        this.series = [];\n        this.render();\n    }\n\n    onRender() {\n        this.data = this.parseSeries(this.series);\n    }\n\n    parseSeries(series) {\n        return _.map(this.series, (serie, i) => {\n            return {\n                label: serie.alias,\n                data: serie.flotpairs[0],\n                color: this.panel.aliasColors[serie.alias] || this.$rootScope.colors[i]\n            };\n        });\n    }\n\n    onDataReceived(dataList) {\n        this.series = dataList.map(this.seriesHandler.bind(this));\n        this.data = this.parseSeries(this.series);\n        this.render(this.data);\n    }\n\n    seriesHandler(seriesData) {\n        var series = new TimeSeries({\n            datapoints: seriesData.datapoints,\n            alias: seriesData.target\n        });\n\n        series.flotpairs = series.getFlotPairs(this.panel.nullPointMode);\n\n        return series;\n    }\n\n    getDecimalsForValue(value) {\n        if (_.isNumber(this.panel.decimals)) {\n            return {decimals: this.panel.decimals, scaledDecimals: null};\n        }\n\n        var delta = value / 2;\n        var dec = -Math.floor(Math.log(delta) / Math.LN10);\n\n        var magn = Math.pow(10, -dec);\n        var norm = delta / magn; // norm is between 1.0 and 10.0\n        var size;\n\n        if (norm < 1.5) {\n            size = 1;\n        } else if (norm < 3) {\n            size = 2;\n            // special case for 2.5, requires an extra decimal\n            if (norm > 2.25) {\n                size = 2.5;\n                ++dec;\n            }\n        } else if (norm < 7.5) {\n            size = 5;\n        } else {\n            size = 10;\n        }\n\n        size *= magn;\n\n        // reduce starting decimals if not needed\n        if (Math.floor(value) === value) {\n            dec = 0;\n        }\n\n        var result = {};\n        result.decimals = Math.max(0, dec);\n        result.scaledDecimals = result.decimals - Math.floor(Math.log(size) / Math.LN10) + 2;\n\n        return result;\n    }\n\n    formatValue(value) {\n        var decimalInfo = this.getDecimalsForValue(value);\n        var formatFunc = kbn.valueFormats[this.panel.format];\n        if (formatFunc) {\n            return formatFunc(value, decimalInfo.decimals, decimalInfo.scaledDecimals);\n        }\n        return value;\n    }\n\n    link(scope, elem, attrs, ctrl) {\n        var data, panel;\n\n        elem = elem.find('.barchz-panel');\n        var $tooltip = $('<div id=\"tooltip\">');\n\n        ctrl.events.on('render', function () {\n            render();\n            ctrl.renderingCompleted();\n        });\n\n        function setElementHeight() {\n            try {\n                var height = ctrl.height || panel.height || ctrl.row.height;\n                if (_.isString(height)) {\n                    height = parseInt(height.replace('px', ''), 10);\n                }\n\n                height -= 5; // padding\n                height -= panel.title ? 24 : 9; // subtract panel title bar\n\n                elem.css('height', height + 'px');\n\n                return true;\n            } catch (e) { // IE throws errors sometimes\n                return false;\n            }\n        }\n\n        function processOffsetHook(plot, gridMargin) {\n            var left = panel.yaxis;\n            var right = panel.yaxis;\n            if (left.show && left.label) { gridMargin.left = 20; }\n            if (right.show && right.label) { gridMargin.right = 20; }\n        }\n\n        function drawHook(plot) {\n             // add left axis labels\n            if (panel.yaxis.label) {\n                var yaxisLabel = $(\"<div class='axisLabel left-yaxis-label'></div>\")\n                    .text(panel.yaxis.label)\n                    .appendTo(elem);\n\n                yaxisLabel[0].style.marginTop = (elem.height() / 6) + 'px';\n            }\n        }\n\n        function addbarchz() {\n            var width = elem.width();\n            var height = elem.height();\n\n            var size = Math.min(width, height);\n\n            var plotCanvas = $('<div></div>');\n            var plotCss = {\n                top: '10px',\n                margin: 'auto',\n                position: 'relative',\n                height: (size - 20) + 'px'\n            };\n\n            plotCanvas.css(plotCss);\n\n            var $panelContainer = elem.parents('.panel-container');\n            var backgroundColor = $panelContainer.css('background-color');\n\n            elem.html(plotCanvas);\n\n            var plotSeries = [];\n            var plotTicksX = [];\n            var plotTicksY = [];\n            var TotalAxisX=0;\n\n            _.map(data, function(origData, i) {\n              TotalAxisX = TotalAxisX +origData.data[1];\n\n                plotSeries.push({\n                                    label: origData.label,\n                                    data: [\n                                      [\n                                         origData.data[1],  //Se inviritio este renglon para la grafica horizonta\n                                         1\n                                      ]\n                                      /*,\n                                      [\n                                         origData.data[1]*0.2,  //Se inviritio este renglon para la grafica horizonta\n                                         2\n                                      ],\n                                      [\n                                         origData.data[1]*0.4,  //Se inviritio este renglon para la grafica horizonta\n                                         3\n                                      ]*/\n                                  ],\n\n                                    color: origData.color,\n\n                                    xaxis: {\n                                        ticks: [origData.data[1], origData.data[1]]\n                                    }\n                                });\n                plotTicksX.push([\n                                   origData.data[1],\n                                   origData.data[1]\n                               ]);\n                plotTicksY.push([\n                                    i,\n                                    origData.label\n                                  ]);\n\n\n            });\n\n            var options = {\n              series: {\n                  stack: true,\n                  bars: {\n                      show: true\n                  }\n              },\n              bars: {\n                  align: \"center\",\n                  horizontal: true,\n                  barWidth: .8,\n                  lineWidth: 0\n              },\n                hooks: {\n                    draw: [drawHook],\n                    processOffset: [processOffsetHook],\n                },\n                legend: {\n                    show: false\n                },\n                xaxis: {\n                    max: 100,\n                    //ticks: plotTicksX,\n                    show: panel.xaxis.show,\n                    tickFormatter: function (val, axis) {\n                        return ctrl.formatValue(val);\n                    }\n                },\n                yaxis: {\n                  ticks:plotTicksY,\n                    show: panel.yaxis.show,\n                    tickFormatter: function (val, axis) {\n                        return ctrl.formatValue(val);\n                    }\n                },\n                shadowSize: 0,\n                grid: {\n                    minBorderMargin: 0,\n                    markings: [],\n                    backgroundColor: backgroundColor,\n                    borderWidth: 0,\n                    hoverable: true,\n                    color: '#c8c8c8',\n                    margin: {left: 0, right: 0},\n                },\n                selection: {\n                    mode: \"y\",\n                    color: '#666'\n                }\n            };\n\n            //console.log(plotSeries);\n            //console.log(TotalAxisX);\n            options.xaxis.max=TotalAxisX;\n            //console.log(options);\n\n\n            $.plot(plotCanvas, plotSeries, options);\n            plotCanvas.bind(\"plothover\", function (event, pos, item) {\n                if (!item) {\n                    $tooltip.detach();\n                    return;\n                }\n\n                var body;\n                var formatted = ctrl.formatValue(item.series.data[0][0]);\n                body = '<div class=\"graph-tooltip-small\"><div class=\"graph-tooltip-time\">';\n                body += '<div class=\"graph-tooltip-value\">' + item.series.label + ': ' + formatted;\n                body += '</div>';\n                body += \"</div></div>\";\n                $tooltip.html(body).place_tt(pos.pageX + 20, pos.pageY);\n            });\n        }\n\n\n        function render() {\n            if (!ctrl.data) {\n                return;\n            }\n\n            data = ctrl.data;\n            panel = ctrl.panel;\n\n            if (setElementHeight()) {\n                addbarchz();\n            }\n        }\n    }\n}\n\nbarchzCtrl.templateUrl = 'module.html';\n\nexport {\n    barchzCtrl as PanelCtrl\n};\n"]}